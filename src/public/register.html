<!-- public/register.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign Up - Mentor Scoring AI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/auth.css" />
    <style>
      /* Copy all styles from login.html and add these: */
      .tab-container {
        margin-bottom: 2rem;
      }

      .tabs {
        display: flex;
        border-bottom: 2px solid var(--glass-border);
        margin-bottom: 1.5rem;
      }

      .tab {
        flex: 1;
        padding: 12px;
        text-align: center;
        cursor: pointer;
        font-weight: 600;
        border-bottom: 3px solid transparent;
        transition: all 0.3s ease;
      }

      .tab:hover {
        color: var(--secondary);
      }

      .tab.active {
        color: var(--primary);
        border-bottom-color: var(--primary);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .institution-info {
        background: rgba(27, 152, 224, 0.1);
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 1.5rem;
        border-left: 4px solid var(--secondary);
      }

      .institution-info p {
        margin: 5px 0;
        font-size: 0.9rem;
      }

      .info-note {
        font-size: 0.8rem;
        color: #666;
        margin-top: 5px;
        font-style: italic;
      }

      .form-row {
        display: flex;
        gap: 15px;
        margin-bottom: 1.5rem;
      }

      .form-row .form-group {
        flex: 1;
        margin-bottom: 0;
      }
    </style>
  </head>
  <body>
    <div class="auth-container">
      <div class="glass-card">
        <div class="logo-header">
          <span>üéì</span>
          <h1>Join Mentor Scoring AI</h1>
          <p>Create your account</p>
        </div>

        <div class="alert" id="alert-message"></div>

        <div class="tab-container">
          <div class="tabs">
            <div class="tab active" data-tab="individual">
              Individual Teacher
            </div>
            <div class="tab" data-tab="institution">Institution Admin</div>
          </div>

          <!-- Individual Registration -->
          <div class="tab-content active" id="individual-tab">
            <form id="individual-form">
              <div class="form-group">
                <label for="ind-name">Full Name</label>
                <input
                  type="text"
                  id="ind-name"
                  class="form-input"
                  placeholder="John Doe"
                  required
                />
              </div>

              <div class="form-group">
                <label for="ind-email">Email Address</label>
                <input
                  type="email"
                  id="ind-email"
                  class="form-input"
                  placeholder="you@example.com"
                  required
                />
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="ind-password">Password</label>
                  <input
                    type="password"
                    id="ind-password"
                    class="form-input"
                    placeholder="Min. 8 characters"
                    required
                    minlength="8"
                  />
                </div>
                <div class="form-group">
                  <label for="ind-confirm-password">Confirm Password</label>
                  <input
                    type="password"
                    id="ind-confirm-password"
                    class="form-input"
                    placeholder="Confirm password"
                    required
                  />
                </div>
              </div>

              <div class="form-group">
                <label for="ind-institution-code"
                  >Institution Code (Optional)</label
                >
                <input
                  type="text"
                  id="ind-institution-code"
                  class="form-input"
                  placeholder="e.g., IIT-B-HACK"
                />
                <p class="info-note">
                  If you're part of an institution, enter the code provided by
                  your admin. You can skip this if you're an independent
                  teacher.
                </p>
              </div>

              <button type="submit" class="btn btn-primary" id="individual-btn">
                <span id="ind-btn-text">Create Individual Account</span>
              </button>
            </form>
          </div>

          <!-- Institution Registration -->
          <div class="tab-content" id="institution-tab">
            <div class="institution-info">
              <p>
                <i class="fas fa-info-circle"></i>
                <strong>Institution Account Benefits:</strong>
              </p>
              <p>‚Ä¢ Track all teachers from your institution</p>
              <p>‚Ä¢ Get institution-wide analytics</p>
              <p>‚Ä¢ Generate institution codes for teachers</p>
            </div>

            <form id="institution-form">
              <div class="form-group">
                <label for="inst-name">Your Name (Admin)</label>
                <input
                  type="text"
                  id="inst-name"
                  class="form-input"
                  placeholder="Your full name"
                  required
                />
              </div>

              <div class="form-group">
                <label for="inst-email">Email Address</label>
                <input
                  type="email"
                  id="inst-email"
                  class="form-input"
                  placeholder="admin@institution.com"
                  required
                />
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="inst-password">Password</label>
                  <input
                    type="password"
                    id="inst-password"
                    class="form-input"
                    placeholder="Min. 8 characters"
                    required
                    minlength="8"
                  />
                </div>
                <div class="form-group">
                  <label for="inst-confirm-password">Confirm Password</label>
                  <input
                    type="password"
                    id="inst-confirm-password"
                    class="form-input"
                    placeholder="Confirm password"
                    required
                  />
                </div>
              </div>

              <div class="form-group">
                <label for="inst-institution-name">Institution Name</label>
                <input
                  type="text"
                  id="inst-institution-name"
                  class="form-input"
                  placeholder="e.g., IIT Bombay"
                  required
                />
              </div>

              <div class="form-group">
                <label for="inst-description"
                  >Institution Description (Optional)</label
                >
                <textarea
                  id="inst-description"
                  class="form-input"
                  placeholder="Brief description of your institution"
                  rows="3"
                ></textarea>
              </div>

              <button
                type="submit"
                class="btn btn-primary"
                id="institution-btn"
              >
                <span id="inst-btn-text">Create Institution Account</span>
              </button>
            </form>
          </div>
        </div>

        <div class="auth-links">
          <p>
            Already have an account?
            <a href="login.html">Login here</a>
          </p>
          <p>
            <a href="index.html">‚Üê Back to Home</a>
          </p>
        </div>
      </div>
    </div>

    <script src="js/auth.js"></script>
    <script>
      // Tab switching
      document.querySelectorAll(".tab").forEach((tab) => {
        tab.addEventListener("click", () => {
          const tabId = tab.dataset.tab;

          // Update tabs
          document
            .querySelectorAll(".tab")
            .forEach((t) => t.classList.remove("active"));
          tab.classList.add("active");

          // Update content
          document.querySelectorAll(".tab-content").forEach((content) => {
            content.classList.remove("active");
          });
          document.getElementById(`${tabId}-tab`).classList.add("active");
        });
      });

      // Individual form submission
      document
        .getElementById("individual-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const name = document.getElementById("ind-name").value;
          const email = document.getElementById("ind-email").value;
          const password = document.getElementById("ind-password").value;
          const confirmPassword = document.getElementById(
            "ind-confirm-password"
          ).value;
          const institutionCode = document.getElementById(
            "ind-institution-code"
          ).value;

          const btn = document.getElementById("individual-btn");
          const btnText = document.getElementById("ind-btn-text");
          const alert = document.getElementById("alert-message");

          // Validation
          if (password !== confirmPassword) {
            alert.textContent = "Passwords do not match!";
            alert.className = "alert alert-error";
            alert.style.display = "block";
            return;
          }

          if (password.length < 8) {
            alert.textContent = "Password must be at least 8 characters!";
            alert.className = "alert alert-error";
            alert.style.display = "block";
            return;
          }

          // Show loading
          btn.disabled = true;
          btnText.innerHTML = '<div class="loading"></div> Creating account...';

          try {
            const result = await authService.registerIndividual(
              email,
              password,
              name,
              institutionCode || null
            );

            // Show success message
            alert.textContent = "Account created successfully! Redirecting...";
            alert.className = "alert alert-success";
            alert.style.display = "block";

            // Redirect to dashboard
            setTimeout(() => {
              window.location.href = "dashboard.html";
            }, 1500);
          } catch (error) {
            // Show error message
            alert.textContent = error.message;
            alert.className = "alert alert-error";
            alert.style.display = "block";

            // Reset button
            btn.disabled = false;
            btnText.textContent = "Create Individual Account";
          }
        });

      // Institution form submission
      document
        .getElementById("institution-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const name = document.getElementById("inst-name").value;
          const email = document.getElementById("inst-email").value;
          const password = document.getElementById("inst-password").value;
          const confirmPassword = document.getElementById(
            "inst-confirm-password"
          ).value;
          const institutionName = document.getElementById(
            "inst-institution-name"
          ).value;
          const description = document.getElementById("inst-description").value;

          const btn = document.getElementById("institution-btn");
          const btnText = document.getElementById("inst-btn-text");
          const alert = document.getElementById("alert-message");

          // Validation
          if (password !== confirmPassword) {
            alert.textContent = "Passwords do not match!";
            alert.className = "alert alert-error";
            alert.style.display = "block";
            return;
          }

          if (password.length < 8) {
            alert.textContent = "Password must be at least 8 characters!";
            alert.className = "alert alert-error";
            alert.style.display = "block";
            return;
          }

          // Show loading
          btn.disabled = true;
          btnText.innerHTML =
            '<div class="loading"></div> Creating institution...';

          try {
            const result = await authService.registerInstitution(
              email,
              password,
              name,
              institutionName,
              description || ""
            );

            // Show success message with institution code
            alert.innerHTML = `
                <strong>üéâ Institution Created!</strong><br>
                Your institution code: <strong>${result.institution.code}</strong><br>
                Share this code with teachers to join your institution.<br>
                Redirecting to dashboard...
            `;
            alert.className = "alert alert-success";
            alert.style.display = "block";

            // Redirect to institution dashboard
            setTimeout(() => {
              window.location.href = "institution-dashboard.html";
            }, 2000);
          } catch (error) {
            // Show error message
            alert.textContent = error.message;
            alert.className = "alert alert-error";
            alert.style.display = "block";

            // Reset button
            btn.disabled = false;
            btnText.textContent = "Create Institution Account";
          }
        });

      // Check if already logged in
      if (authService.isLoggedIn()) {
        const user = authService.getUser();
        if (user.userType === "institution_admin") {
          window.location.href = "institution-dashboard.html";
        } else {
          window.location.href = "dashboard.html";
        }
      }
    </script>
  </body>
</html>
